<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherSearch</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
</head>
<body style="background-color:lightgrey;">
    <div class="navbar navbar-inverse navbar-fixed-top" style="margin-top:8px;margin-left:10px;margin-right:10px; background-color:#333333">
        {% if 'username' in session %}
            <a href="{{ url_for('dashboard') }}">Home</a>
            <a href="{{ url_for('weather') }}">Weather Search</a>
            <a href=#>Page 2</a>
        {% else %}
            <a href="{{ url_for('login') }}">Home</a>
        {% endif %}

        {% if 'username' in session %}
            <a href="{{ url_for('logout') }}"class="right">Logout</a>
            <a class="right">{{session['username']}}</a>

        {% else %}
            <a href="{{ url_for('login') }}" class="right">Login</a>
            <a href="{{ url_for('register') }}" class="right">Register</a>
        {% endif %}
    </div>
     <br>
     <br>
     <br>
  <center class="row">
    <form method="post" class="col-md-6 col-md-offset-3">
      <div class="input-group">
        <input type="text" class="form-control" name="city" placeholder="Search" id="city-input">
          <input type="hidden" name="selected_city" id="selected-city" value="{{maindata[0]['cityname']}}">
        <div class="input-group-btn">
          <button class="btn btn-primary" type="submit">
            <i class="glyphicon glyphicon-search"></i>
          </button>
        </div>
      </div>
    </form>
  </center>
    {% if maindata %}
     <div class="weather_data_print" id="weather_data_print">
        <div class="weather-icon">
            <!--<img src="weather-icon.png" alt=" ">-->
        </div>
        <div class="temperature">
            {{maindata[0]['temperature_max']}}<span>째C </span>
        </div>
        <div class="weather-info">
            <div>Precipitation: {{maindata[0]['precipitation']}}%</div>
            <div>Humidity: {{maindata[0]['humidity_max']}}%</div>
            <div>Wind: {{maindata[0]['windspeed_max']}} km/h</div>
        </div>
        <div class="weather-details">
            <div class="weather-title">{{maindata[0]['cityname']}}</div>
            <div class="weather-day">{{maindata[0]['day']}}</div>
            <div class="weather-description">{{maindata[0]['weather_code']}}</div>
        </div>
     </div>
    <div class="forcast_data_print">
     <div class="forecast">
         {% for data in maindata %}
        <button class="day highlight" onclick="fetchWeatherData('{{ data['day']}}')">
            <p>{{ data['day'] }}</p>
            <!---<img src="partly_cloudy.png" alt=" ">-->
            <p class="paragraph_secondrow">{{ data['temperature_max'] }}째   {{ data['temperature_min'] }}째</p>
        </button>
         {% endfor %}
        </div>
        {% endif %}
    </div>
    <script>
    document.querySelector('form').onsubmit = function(event) {
        event.preventDefault();
       console.log(`The hidden file has been updated : ${document.getElementById('selected-city').value}`);
       this.submit();
    }

    function fetchWeatherData(day) {
        console.log(`The hidden file has been updated : ${document.getElementById('selected-city').value}`);
        const selectedCity = document.getElementById('selected-city').value || 'hyderabad';
        console.log(`Fetching weather data for: ${day} in ${selectedCity}`);  // Debugging information

        fetch(`/weather?day=${day}&city=${selectedCity}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Data received:', data);  // Debugging information
                document.querySelector('#weather_data_print .temperature').innerHTML = data.temperature_max + '<span>째C </span>';
                document.querySelector('#weather_data_print .weather-info').innerHTML = `
                    <div>Precipitation: ${data.precipitation}%</div>
                    <div>Humidity: ${data.humidity_max}%</div>
                    <div>Wind: ${data.windspeed_max} km/h</div>
                `;
                document.querySelector('#weather_data_print .weather-title').textContent = data.cityname;
                document.querySelector('#weather_data_print .weather-day').textContent = data.day;
                document.querySelector('#weather_data_print .weather-description').textContent = data.weather_code;
            })
            .catch(error => console.error('Error fetching weather data:', error));
    }
</script>

</body>
</html>
